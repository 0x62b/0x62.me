<!doctype html>
<html>
  <head>
    <title>Reader</title>
    <link rel="stylesheet" type="text/css" href="/static/css/main.css"/> 
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
    <script>
      async function load(filename) {
        const res = await fetch(`posts/${filename}`);
        const text = await res.text();
        document.getElementById("content").innerHTML = marked.parse(text);
      }

      async function prev() {
        const res = await fetch("posts.json");
        const json = await res.json();
        const posts = json.posts;

        for (let i = 0; i < posts.length; i++) {
          if (posts[i].filename == new URLSearchParams(location.search).get('post')) {
            if (i-1 >= 0) {
              const newPost = posts[i-1].filename;
              load(newPost);
              const url = new URL(window.location);
              url.searchParams.set('post', newPost);
              window.history.pushState({}, '', url);
            } else {
              alert("you've reached the start!");
            }
            break;
          }
        }
      }

      async function next() {
        const res = await fetch("posts.json");
        const json = await res.json();
        const posts = json.posts;
        
        for (let i = 0; i < posts.length; i++) {
          if (posts[i].filename == new URLSearchParams(location.search).get('post')) {
            if (i+1 < posts.length) {
              const newPost = posts[i+1].filename;
              load(newPost);
              const url = new URL(window.location);
              url.searchParams.set('post', newPost);
              window.history.pushState({}, '', url);
            } else {
              alert("no more posts!");
            }
            break;
          }
        }
      }

      load(new URLSearchParams(location.search).get('post'));
    </script>
  </head>
  <body style="height: 95vh">
    <div style="display: flex; justify-content: space-between;">
      <a onClick="prev()" class="text-green cursor-pointer"><u>Prev</u></a>
      <a href="/blog" class="text-green">Home</a>
      <a onclick="next()" class="text-green cursor-pointer"><u>Next</u></a>
    </div>
    <div style="height: 80%">
      <div id="content" width="100%" height="100%"></div>
    </div>
    <div style="height: 15%;">
      <embed id="footer" src="/footer.html" type="text/html" width="100%" height="100%"/>
    </div>
  </body>
</html>