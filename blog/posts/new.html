<!doctype html>
<html>
  <head>
    <title>New Post</title>
    <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
    <script>
      function handleChange(e) {
        document.getElementById("preview").innerHTML = marked.parse(e.target.value);
      }

      async function submitPost() {
        const title = document.getElementById("title").value;
        const content = document.getElementById("content").value;
        const description = document.getElementById("description").value;
        const auth = document.getElementById("auth").value;

        if (!auth) {
          alert("you need to authenticate");
          return;
        }

        if (!title) {
          if (!content) {
            if (!description) {
              alert("missing title/content/description");
            } else {
              alert("missing title/content");
            }
          } else if (!description) {
            alert("missing title/description");
          } else {
            alert("missing title");
          }
          return;
        } else if (!content) {
          if (!description) {
            alert("missing content/description");
          } else {
            alert("missing content");
          }
          return;
        } else if (!description) {
          alert("missing description");
          return;
        }

        const data = new FormData();
        data.append("title", title);
        data.append("content", content);
        data.append("timestamp", Date.now());
        data.append("description", description);
        data.append("auth", auth);

        const res = await fetch("https://0x62.me:8000/api/posts/new", {
          method: "POST",
          body: data
        });

        if (res.ok) {
          alert("success");
          location.href = "/blog"
        } else {
          alert(`failed to create post, ${res.statusText} - ${(await res.json()).error}`);
        }
      }
    </script>
  </head>
  <body style="height: 95vh;">
    <a href="/blog" class="text-green">Return</a>
    <h1>New Post</h1>
    <input
      id="title"
      type="text"
      placeholder="Title"
      style="background: #444; border: none; margin: 4px; padding: 8px; color: white; font-size: 16px;"
      class="text-white"
    />
    <input
      id="description"
      type="text"
      placeholder="Description"
      style="background: #444; border: none; margin: 4px; padding: 8px; color: white; font-size: 16px;"
      class="text-white"
    />
    <input
      id="auth"
      type="password"
      placeholder="Password"
      style="background: #444; border: none; margin: 4px; padding: 8px; color: white; font-size: 16px;"
      class="text-white"
    />

    <div style="display: flex; flex-direction: row; height: 70%;">
      <textarea
        id="content"
        style="background: #444; border: none; width: 50%; margin: 4px; height: 100%;"
        class="text-white"
        placeholder="Post"
        onkeyup="handleChange(event)"
      ></textarea>
      <div id="preview" style="width: 50%; margin: 4px; height: 100%; overflow-y: auto;"></div>
    </div>
    <button
      onclick="submitPost()"
      style="background: lightgray; border: none; padding: 16px;"
    >
      Create Post
    </button>
  </body>
</html>